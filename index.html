<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>createsend-php by campaignmonitor</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>createsend-php</h1>
        <p>A PHP library for the Campaign Monitor API</p>

        <p class="view"><a href="https://github.com/campaignmonitor/createsend-php">View the Project on GitHub <small>campaignmonitor/createsend-php</small></a></p>


        <ul>
          <li><a href="https://github.com/campaignmonitor/createsend-php/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/campaignmonitor/createsend-php/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/campaignmonitor/createsend-php">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h1>createsend <a href="http://travis-ci.org/campaignmonitor/createsend-php"><img src="https://secure.travis-ci.org/campaignmonitor/createsend-php.png" alt="Build Status"></a>
</h1>

<p>A PHP library which implements the complete functionality of the <a href="http://www.campaignmonitor.com/api/">Campaign Monitor API</a>.</p>

<h2>Installation</h2>

<p>If you use <a href="http://getcomposer.org/">Composer</a>, you can add <a href="https://packagist.org/packages/campaignmonitor/createsend-php">campaignmonitor/createsend-php</a> to your <code>composer.json</code> file:</p>

<div class="highlight"><pre><span class="p">{</span>
    <span class="nt">"require"</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">"campaignmonitor/createsend-php"</span><span class="p">:</span> <span class="s2">"{version}"</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Otherwise you can simply <a href="https://github.com/campaignmonitor/createsend-php/tags">download</a> the library and include it in your project.</p>

<p>After you have installed the library, simply include the relevant API class, as follows:</p>

<div class="highlight"><pre><span class="k">require_once</span> <span class="s1">'csrest_campaigns.php'</span>
</pre></div>

<h2>Authenticating</h2>

<p>The Campaign Monitor API supports authentication using either OAuth or an API key.</p>

<h3>Using OAuth</h3>

<p>Depending on the environment you are developing in, you may wish to use a PHP OAuth library to get access tokens for your users. If you don't use an OAuth library, you will need to get access tokens for your users by following the instructions included in the Campaign Monitor API <a href="http://www.campaignmonitor.com/api/getting-started/#authenticating_with_oauth">documentation</a>. This package provides functionality to help you do this, as described below. You may also wish to reference this <a href="https://gist.github.com/jdennes/4973318">example application</a>, which is implemented using <a href="http://slimframework.com/">Slim</a> but could easily be adapted for use with any PHP framework.</p>

<p>The first thing your application should do is redirect your user to the Campaign Monitor authorization URL where they will have the opportunity to approve your application to access their Campaign Monitor account. You can get this authorization URL by using the <code>CS_REST_General::authorize_url()</code> method, like so:</p>

<div class="highlight"><pre><span class="k">require_once</span> <span class="s1">'csrest_general.php'</span><span class="p">;</span>

<span class="nv">$authorize_url</span> <span class="o">=</span> <span class="nx">CS_REST_General</span><span class="o">::</span><span class="na">authorize_url</span><span class="p">(</span>
    <span class="s1">'Client ID for your application'</span><span class="p">,</span>
    <span class="s1">'Redirect URI for your application'</span><span class="p">,</span>
    <span class="s1">'The permission level your application requires'</span><span class="p">,</span>
    <span class="s1">'Optional state data to be included'</span>
<span class="p">);</span>
<span class="c1"># Redirect your users to $authorize_url.</span>
</pre></div>

<p>If your user approves your application, they will then be redirected to the <code>redirect_uri</code> you specified, which will include a <code>code</code> parameter, and optionally a <code>state</code> parameter in the query string. Your application should implement a handler which can exchange the code passed to it for an access token, using <code>CS_REST_General::exchange_token()</code> like so:</p>

<div class="highlight"><pre><span class="k">require_once</span> <span class="s1">'csrest_general.php'</span><span class="p">;</span>

<span class="nv">$result</span> <span class="o">=</span> <span class="nx">CS_REST_General</span><span class="o">::</span><span class="na">exchange_token</span><span class="p">(</span>
    <span class="s1">'Client ID for your application'</span><span class="p">,</span>
    <span class="s1">'Client Secret for your application'</span><span class="p">,</span>
    <span class="s1">'Redirect URI for your application'</span><span class="p">,</span>
    <span class="s1">'A unique code for your user'</span> <span class="c1"># Get the code parameter from the query string</span>
<span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$result</span><span class="o">-&gt;</span><span class="na">was_successful</span><span class="p">())</span> <span class="p">{</span>
    <span class="nv">$access_token</span> <span class="o">=</span> <span class="nv">$result</span><span class="o">-&gt;</span><span class="na">response</span><span class="o">-&gt;</span><span class="na">access_token</span><span class="p">;</span>
    <span class="nv">$expires_in</span> <span class="o">=</span> <span class="nv">$result</span><span class="o">-&gt;</span><span class="na">response</span><span class="o">-&gt;</span><span class="na">expires_in</span><span class="p">;</span>
    <span class="nv">$refresh_token</span> <span class="o">=</span> <span class="nv">$result</span><span class="o">-&gt;</span><span class="na">response</span><span class="o">-&gt;</span><span class="na">refresh_token</span><span class="p">;</span>
    <span class="c1"># Save $access_token, $expires_in, and $refresh_token.</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="s1">'An error occurred:\n'</span><span class="p">;</span>
    <span class="k">echo</span> <span class="nv">$result</span><span class="o">-&gt;</span><span class="na">response</span><span class="o">-&gt;</span><span class="na">error</span><span class="o">.</span><span class="s1">': '</span><span class="o">.</span><span class="nv">$result</span><span class="o">-&gt;</span><span class="na">response</span><span class="o">-&gt;</span><span class="na">error_description</span><span class="o">.</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
    <span class="c1"># Handle error...</span>
<span class="p">}</span>
</pre></div>

<p>At this point you have an access token and refresh token for your user which you should store somewhere convenient so that your application can look up these values when your user wants to make future Campaign Monitor API calls.</p>

<p>Once you have an access token and refresh token for your user, you can authenticate and make further API calls like so:</p>

<div class="highlight"><pre><span class="k">require_once</span> <span class="s1">'csrest_general.php'</span><span class="p">;</span>

<span class="nv">$auth</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">'access_token'</span> <span class="o">=&gt;</span> <span class="s1">'your access token'</span><span class="p">,</span>
    <span class="s1">'refresh_token'</span> <span class="o">=&gt;</span> <span class="s1">'your refresh_token'</span><span class="p">);</span>
<span class="nv">$wrap</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">CS_REST_General</span><span class="p">(</span><span class="nv">$auth</span><span class="p">);</span>

<span class="nv">$result</span> <span class="o">=</span> <span class="nv">$wrap</span><span class="o">-&gt;</span><span class="na">get_clients</span><span class="p">();</span>
<span class="nb">var_dump</span><span class="p">(</span><span class="nv">$result</span><span class="o">-&gt;</span><span class="na">response</span><span class="p">);</span>
</pre></div>

<p>All OAuth tokens have an expiry time, and can be renewed with a corresponding refresh token. If your access token expires when attempting to make an API call, you will receive an error response, so your code should handle this. Here's an example of how you could do this:</p>

<div class="highlight"><pre><span class="k">require_once</span> <span class="s1">'csrest_general.php'</span><span class="p">;</span>

<span class="nv">$auth</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">'access_token'</span> <span class="o">=&gt;</span> <span class="s1">'your access token'</span><span class="p">,</span>
    <span class="s1">'refresh_token'</span> <span class="o">=&gt;</span> <span class="s1">'your refresh token'</span>
<span class="p">);</span>
<span class="nv">$wrap</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">CS_REST_General</span><span class="p">(</span><span class="nv">$auth</span><span class="p">);</span>
<span class="nv">$result</span> <span class="o">=</span> <span class="nv">$wrap</span><span class="o">-&gt;</span><span class="na">get_clients</span><span class="p">();</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$result</span><span class="o">-&gt;</span><span class="na">was_successful</span><span class="p">())</span> <span class="p">{</span>
    <span class="c1"># If you receive '121: Expired OAuth Token', refresh the access token</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$result</span><span class="o">-&gt;</span><span class="na">response</span><span class="o">-&gt;</span><span class="na">Code</span> <span class="o">==</span> <span class="mi">121</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">list</span><span class="p">(</span><span class="nv">$new_access_token</span><span class="p">,</span> <span class="nv">$new_expires_in</span><span class="p">,</span> <span class="nv">$new_refresh_token</span><span class="p">)</span> <span class="o">=</span> 
            <span class="nv">$wrap</span><span class="o">-&gt;</span><span class="na">refresh_token</span><span class="p">();</span>
        <span class="c1"># Save $new_access_token, $new_expires_in, and $new_refresh_token</span>
    <span class="p">}</span>
    <span class="c1"># Make the call again</span>
    <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$wrap</span><span class="o">-&gt;</span><span class="na">get_clients</span><span class="p">();</span>
<span class="p">}</span>
<span class="nb">var_dump</span><span class="p">(</span><span class="nv">$result</span><span class="o">-&gt;</span><span class="na">response</span><span class="p">);</span>
</pre></div>

<h3>Using an API key</h3>

<div class="highlight"><pre><span class="k">require_once</span> <span class="s1">'csrest_general.php'</span><span class="p">;</span>

<span class="nv">$auth</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">'api_key'</span> <span class="o">=&gt;</span> <span class="s1">'your API key'</span><span class="p">);</span>
<span class="nv">$wrap</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">CS_REST_General</span><span class="p">(</span><span class="nv">$auth</span><span class="p">);</span>

<span class="nv">$result</span> <span class="o">=</span> <span class="nv">$wrap</span><span class="o">-&gt;</span><span class="na">get_clients</span><span class="p">();</span>
<span class="nb">var_dump</span><span class="p">(</span><span class="nv">$result</span><span class="o">-&gt;</span><span class="na">response</span><span class="p">);</span>
</pre></div>

<h2>Examples</h2>

<p>Samples for creating or accessing all resources can be found in the samples directory.
These samples can be used as the basis for your own application and provide an outline of 
the expected inputs for each API call. </p>

<p>Further documentation of the inputs and outputs of each call can be found in the 
documentation in each of the csrest_*.php files or simply by examining the 
var_dump results in each of the provided samples.</p>

<h2>Contributing</h2>

<p>Please check the <a href="https://github.com/campaignmonitor/createsend-php/blob/master/CONTRIBUTING.md">guidelines for contributing</a> to this repository.</p>
      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/campaignmonitor">campaignmonitor</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
    
  </body>
</html>